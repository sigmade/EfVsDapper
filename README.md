# EfVsDapper

?????? ????????? EF Core ? Dapper.

## 1. ?????? PostgreSQL ????? Docker Compose (??????? ???????????)
? ??????????? ??? ???? `docker-compose.yml`, ??????????? ?????? PostgreSQL (API ??????????? ???????? ?? ?????).

```bash
docker compose up -d
```
(??? `docker-compose up -d` ??? ?????? ?????? Docker)

????????:
```bash
docker ps
# ?????? ???? ?????????: postgres
```

?????? ??????????? ? `API/appsettings.json` ????????:
```
Host=localhost;Port=5432;Database=efvsdapper_db;Username=postgres;Password=postgres
```
???? ???????? ???-?? ??????? `Host=postgres` — ??? ????????? ??????? API ??? ???????? ?? ????? (DNS ????? ???). ??? ? `Program.cs` ????????????? ??????????? ???.

## 2. ???????? ????
```bash
docker exec -it postgres psql -U postgres -d efvsdapper_db -c "\dt"
```
(??? ?????????? `postgres`, ?????? ??? ??? ?????? ? compose.)

## 3. ?????? API (?? ?????)
```bash
dotnet restore
dotnet build
dotnet run --project API
```
Swagger: https://localhost:****/swagger

??? ?????? ?????? ??????????? `EnsureCreated()` ? ??????????? ????????? ???????.

## 4. (???????????) ???????, ????? ?????? ????????? ? API ? Docker
???? ???????????? ????????? ? API, ????? ????????? `docker-compose.yml`:
```yaml
services:
  postgres:
    image: postgres:16
    container_name: postgres
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: efvsdapper_db
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data
  api:
    build:
      context: .
      dockerfile: API/Dockerfile
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ConnectionStrings__DefaultConnection: Host=postgres;Port=5432;Database=efvsdapper_db;Username=postgres;Password=postgres
    depends_on:
      - postgres
    ports:
      - "5000:8080"
volumes:
  pgdata:
```
????? ?????? ??????????? ?????? ???????????? `Host=postgres` (??? ??????? ?????? ???? docker compose).

## 5. ???????
```bash
docker compose down -v
```

## 6. ????????
- ????: `docker logs -f postgres`
- ??????????? ?????? ??: `docker compose down -v && docker compose up -d`
- ????????? ????: `netstat -ano | find "5432"` (Windows) / `lsof -i :5432` (Linux/macOS)

??????. ?????????? ? ??????????.